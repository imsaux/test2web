<script type="text/javascript">
function del(){
    if(!confirm("确认要删除？"))
    {
        window.event.returnValue = false;
    }
};
var ckinit = true;
function chall_changed() {
    var oneches=document.getElementsByName("sels");
    for(var i=0;i<oneches.length;i++) {
        if(oneches[i].checked!=ckinit)
        {
            oneches[i].click();
        }
    }
    if(ckinit==true)
    {
        ckinit=false;
    }
    else
    {
        ckinit=true;
    }
}


/**
 * 翻页保存checkbox选择的数据
 */

var checkedIds=""; //翻页保存选中的id
/**
 * 记录选择的元素
 * @return
 */
function sel_changeIds(){
    var oneches=document.getElementsByName("sels");
    for(var i=0;i<oneches.length;i++){
        if(oneches[i].checked==true){
             //避免重复添加（若存在元素时，不添加）
            if(!sel_contains(checkedIds,oneches[i].id)){
                checkedIds+=","+oneches[i].id;
            }
         }
        if(oneches[i].checked==false){
            //取消复选框时 含有该id时将id从全局变量中去除
            if(sel_contains(checkedIds,oneches[i].id)){
                checkedIds=checkedIds.replace((","+oneches[i].id),"");
            }
         }
     }
 }
/**
 *
 * @return
 */
function sel_getChecked(){
    if(checkedIds==""){
        return;
    }
    var oneches=document.getElementsByName("sels");
    for(var i=0;i<oneches.length;i++){
        //全局变量中含有id，则该复选框选中
        if(sel_contains(checkedIds,oneches[i].value)){
             oneches[i].checked="checked";
        }
     }
 }
/**
 * 判断数组是否存在元素
 * @param obj
 * @param ele
 * @return
 */
function sel_contains(obj, ele) {
    if(obj==""){
        return;
    }
    /*若参数obj为字符串时，需要转换成数组*/
    var arr = obj.split(",");
    var i = arr.length;
    while (i--) {
        if (arr[i] == ele) {
            return true;
        }
    }
    return false;
};

function delete_selected(){
    sel_changeIds();
    sel_post('/daily_delete_selected/', checkedIds);
}

function confirm_selected(){
    sel_changeIds();
    sel_post('/daily_confirm_selected/', checkedIds);
}
function unconfirm_selected(){
    sel_changeIds();
    sel_post('/daily_unconfirm_selected/', checkedIds);
}

function sel_post(URL, PARAMS) {
    var temp = document.createElement("form");
    temp.action = URL;
    temp.method = "post";
    temp.style.display = "none";
    var opt = document.createElement("textarea");
    opt.name = "selected";
    opt.value = PARAMS;
    temp.appendChild(opt);
    document.body.appendChild(temp);
    temp.submit();
    return temp;
};



</script>
<div class="row-fluid">
    <div class="box span12">
        <div class="box-header" data-original-title>
            <h2>
                <i class="halflings-icon white edit"></i>
                <span class="break"></span>{{ title }}</h2>
        </div>
        <div class="box-content">
            <table class="table table-striped table-bordered bootstrap-datatable datatable sortable">
                <thead>
                <tr>
                    <th><input type="checkbox" id="ckall" onchange="chall_changed()"/></th>
                    <th>车站</th>
                    <th>过车数量</th>
                    <th>报警数</th>
                    <th>问题及处理</th>
                    <th>问题追踪</th>
                    <th>问题分类</th>
                    <th>状态</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                {% if data is not None %}
                    {% for item in data %}
                        {% if loc == item.5 %}
                            <tr id="_this_">
                        {% else %}
                            <tr>
                        {% endif %}
                            <td><input type="checkbox" id="{{ item.5 }}" name="sels"/></td>
                            <td>{{ item.0 }}</td>
                            <td class="center" contenteditable="true">{{ item.1 }}</td>
                            <td class="center" contenteditable="true">{{ item.2 }}</td>
                            <td class="center" contenteditable="true">{{ item.3 }}</td>
                            <td class="center" contenteditable="true">{{ item.4 }}</td>
                            <td class="center" contenteditable="true">{{ item.7 }}</td>

                            {% if item.6 %}
                                <td class="center">已审批</td>
                            {% else %}
                                <td class="center">未审批</td>
                            {% endif %}
                            <td class="center">
                                {% if item.6 %}
                                    <a class="btn btn-success" href="/daily_unconfirm/{{ item.5 }}" title="取消审批">
                                        <i class="halflings-icon white stop"></i>
                                    </a>
                                {% else %}
                                    <a class="btn btn-success" href="/daily_confirm/{{ item.5 }}" title="审批">
                                        <i class="halflings-icon white ok"></i>
                                    </a>
                                {% endif %}
                                <a class="btn btn-info" href="/daily_edit/{{ item.5 }}" title="编辑">
                                    <i class="halflings-icon white edit"></i>
                                </a>
                                <a class="btn btn-info" href="/daily_delete/{{ item.5 }}" onclick="return del()" title="删除">
                                    <i class="halflings-icon white delete"></i>
                                </a>
                                <a class="btn btn-info" href="/daily_copy/{{ item.5 }}" title="复制">
                                    <i class="halflings-icon white book"></i>
                                </a>
                            </td>
                        </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td class="center" colspan="7">无</td>
                    </tr>
                {% endif %}
                </tbody>
            </table>
        </div>
    </div>
    <!-- content -->
</div>

<div class="row-fluid">
    <div class="box span12">
        <div class="box-header" data-original-title>
            <h2><i class="halflings-icon white edit"></i><span class="break"></span>查询</h2>
        </div>
        <div class="box-content">
            <table style="width: 100%; border: 1px solid;">
                <tbody>
                    <tr>
                        <td style="width: 10%;">车站</td>
                        <td style="width: 90%;"></td>
                    </tr>
                    <tr>
                        <td style="width: 10%;">日期</td>
                        <td style="width: 90%;"></td>
                    </tr>
                    <tr>
                        <td style="width: 10%;">问题分类</td>
                        <td style="width: 90%;"></td>
                    </tr>
                </tbody>
            </table>
            <form class="form-horizontal" enctype="multipart/form-data" action="/daily_manage_search/" method="post">
                <fieldset>
                    <div class="control-group">
                        <label class="control-label" for="selectErrorSite1">站点</label>
                        <div class="controls">
                            <select id="selectErrorSite1" data-rel="chosen" name="r_site">
                                {% for site in all_site %}
                                    {% if site == q_site %}
                                        <option selected="True">{{ site }}</option>
                                    {% else %}
                                        <option>{{ site }}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
        </div>
    </div>
                </fieldset>
            </form>
</div>


<div class="row-fluid" id="test">
    <div class="box span12">
        <div class="box-header" data-original-title>
            <h2><i class="halflings-icon white edit"></i><span class="break"></span>数据操作</h2>
            <div class="box-icon">
                <a href="#" class="btn-minimize"><i class="halflings-icon white chevron-up"></i></a>
            </div>
        </div>
        <div class="box-content">
            <div class="control-group">
                    <a href="/daily_create_single"  class="btn btn-success">
                        <i class="icon-envelope"></i>
                        <span class="hidden-tablet"> 新增</span>
                    </a>
                    <a href="/daily_create_all"  class="btn btn-success">
                        <i class="icon-envelope"></i>
                        <span class="hidden-tablet"> 批量新增</span>
                    </a>
                    <a href="/daily_all_confirm"  class="btn btn-success">
                        <i class="icon-envelope"></i>
                        <span class="hidden-tablet"> 全部审批</span>
                    </a>
                    <a href="/daily_all_unconfirm"  class="btn btn-success">
                        <i class="icon-envelope"></i>
                        <span class="hidden-tablet"> 全部取消审批</span>
                    </a>
                    <a href="javascript:confirm_selected()"  class="btn btn-success">
                        <i class="icon-envelope"></i>
                        <span class="hidden-tablet"> 审批</span>
                    </a>
                    <a href="javascript:unconfirm_selected()"  class="btn btn-success">
                        <i class="icon-envelope"></i>
                        <span class="hidden-tablet"> 取消审批</span>
                    </a>
                    <a href="javascript:delete_selected()"  class="btn btn-success">
                        <i class="icon-envelope"></i>
                        <span class="hidden-tablet"> 删除</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
